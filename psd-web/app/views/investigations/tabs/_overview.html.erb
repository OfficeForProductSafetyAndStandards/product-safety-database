<% page_heading = "Overview" %>
<%= page_title "#{page_heading} - #{@investigation.pretty_id}" %>
<% products_count = @investigation.products.count %>

<div class="govuk-grid-row govuk-!-padding-bottom-6">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-l"><%= @investigation.pretty_description %></span>
    <h1 class="govuk-heading-l"><%= page_heading %></h1>

    <p class="govuk-body-l"><%= @investigation.title %></p>

    <h2 class="govuk-heading-m">Summary</h2>

    <p class="govuk-body"><%= @investigation.description %></p>

    <p class="govuk-body"><%= link_to "Change summary", edit_summary_investigation_path(@investigation), class: "govuk-link" %></p>

    <% if @investigation.display_product_summary_list? %>
      <%= govuk_hr %>
      <h2 class="govuk-heading-m"><%= "product".pluralize(products_count).titleize %></h2>
      <%= @investigation.product_summary_list %>
    <% end %>

    <% if @investigation.complainant %>
      <%= govuk_hr %>
      <h2 class="govuk-heading-m"><%= @investigation.type.demodulize.titleize %></h2>
      <%= @investigation.source_details_summary_list %>
    <% end %>

    <%= govuk_hr %>
    <h2 class="govuk-heading-m">Sharing and collaboration</h2>

    <% team_actions = {
      items: [
        href: new_investigation_collaborator_path(@investigation),
        text: "Add team"
      ]
    } %>

    <% team_list_html = capture do %>
      <% if @investigation.teams_with_access.length > 1 %>
        <ul class="govuk-list">
          <% @investigation.teams_with_access.each do |team| %>
            <li><%= team.name %></li>
          <% end %>
        </ul>
      <% elsif @investigation.teams_with_access.length == 1 %>
        <%= @investigation.teams_with_access.first.name %>
      <% end %>

    <% end %>

    <%= govukSummaryList(
      classes: "govuk-summary-list--no-border",
      rows: [
        # {
        #   key: { text: "Case owner" },
        #   value: { text: investigation_assignee(@investigation) }
        # },
        {
          key: { text: "Teams added to case" },
          value: { text: team_list_html },
          actions: team_actions
        }
      ]
    ) %>

    <%= govuk_hr %>
    <h2 class="govuk-heading-m">About the case</h2>
    <%= @investigation.investigation_summary_list %>


  </div>

  <% if @investigation.products.any? %>
    <div class="govuk-grid-column-one-third">
      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible app-!-display-mobile--only">

      <h2 class="govuk-heading-m"><%= "Products (#{products_count})" %></h2>
      <%= @investigation.products_list %>
    </div>
  <% end %>
</div>
