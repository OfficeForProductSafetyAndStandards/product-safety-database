<%= page_title "Record email", errors: @correspondence.errors.any? %>
<% content_for :back_link do %>
  <%= govukBackLink(
    text: "Back",
    href: new_investigation_correspondence_path(@investigation)
  ) %>
<% end %>

<%= render "investigations/pages_top", investigation: @investigation %>

<%= form_with(model: @correspondence, local: true, url: wizard_path, method: :put) do |form| %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
      <%= render "form_components/govuk_error_summary", form: form %>

      <span class="govuk-caption-l"><%= @investigation.pretty_description %></span>

      <h1 class="govuk-heading-l">Record email</h1>

      <%= render "components/govuk_fieldset", legend: { text: "Email details", classes: "govuk-fieldset__legend--m" } do %>
        <%= render "form_components/govuk_radios",
                   form: form,
                   key: :email_direction,
                   fieldset: { label: { text: "Email direction", classes: "govuk-visually-hidden" } },
                   classes: "govuk-radios--inline",
                   items: Correspondence::Email.email_directions.map { |value, label| { text: label, value: value } } %>
        <%= render "form_components/govuk_input",
                   key: :correspondent_name,
                   form: form,
                   classes: "govuk-!-width-two-thirds",
                   label: { text: "Name" } %>
        <%= render "form_components/govuk_input",
                   key: :email_address,
                   form: form,
                   classes: "govuk-!-width-two-thirds",
                   label: { text: "Email address" } %>
      <% end %>

      <%= render "form_components/govuk_date_input",
                 form: form,
                 key: :correspondence_date,
                 fieldset: { legend: { classes: "govuk-fieldset__legend--m", text: "Date sent" } } %>

      <%= form.submit "Continue", class: "govuk-button" %>

      <%= permission_notice(text: t("case.protected_details", data_type: "email correspondence")) %>
    </div>
  </div>
<% end %>
