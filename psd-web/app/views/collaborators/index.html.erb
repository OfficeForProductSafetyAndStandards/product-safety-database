<% title = "Teams added to the case" %>
<% page_title title %>

<% content_for :back_link do %>
  <%= govukBackLink(
    text: "Back to #{@investigation.decorate.pretty_description.downcase}",
    href: investigation_path(@investigation)
  ) %>
<% end %>

<%= render "investigations/pages_top", investigation: @investigation %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">

    <h1 class="govuk-heading-l"><%= title %></h1>

    <% if policy(@investigation).manage_collaborators? %>
      <%= govukButton(
        text: "Add a team to the case",
        href: new_investigation_collaborator_path(@investigation))
      %>
    <% end %>

    <table class="govuk-table">
      <caption class="govuk-table__body govuk-visually-hidden">Teams added to the case</caption>
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header">Team name</th>
          <th scope="col" class="govuk-table__header">Permission level</th>
          <th scope="col" class="govuk-table__header"></th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        <% if @investigation.owner_team %>
          <tr class="govuk-table__row">
            <th scope="row" class="govuk-table__header govuk-!-font-weight-regular">
              <%= @investigation.owner_team.name %>
              <% if @investigation.creator_team == @investigation.owner_team %>
                <br>
                <span class="app-body--table-heading-supplementary">Case creator</span>
              <% end %>
            </th>
            <td class="govuk-table__cell"><span class="hmcts-badge app-badge--owner">Case owner</span></td>
            <td class="govuk-table__cell"></td>
          </tr>
        <% end %>
        <% @teams.each do |team| %>
          <tr class="govuk-table__row">
            <th scope="row" class="govuk-table__header govuk-!-font-weight-regular">
              <%= team.name %>
              <% if @investigation.creator_team == team %>
                <br>
                <span class="govuk-body govuk-hint">Case creator</span>
              <% end %>
            </th>
            <td class="govuk-table__cell">Edit full case</td>
            <td class="govuk-table__cell app-table__cell--align-right">
              <% if policy(@investigation).manage_collaborators? %>
                <%= link_with_hidden_text_to "Change", "#{team.name}â€™s permission level",  edit_investigation_collaborator_path(@investigation, team) %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <%= permission_notice(text: "Only the case owner can add teams to the case.") %>
  </div>
</div>
