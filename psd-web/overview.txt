;; This buffer is for text that is not saved, and for Lisp evaluation.
;; To create a file, visit it with C-x C-f and enter text in its buffer.

// Product and hazard details
// Allegations always have some product details, and cases with products have some product details

if (investigation.hasProduct or investigation.isAllegation){
  "## Products"
  {{start summaryList}}
    "Product category": getUniqueProductCategories(caseID) : noLink
    "Product details" (investigation.products.length()) + pluralise("product", products.length) + "added": linkToProducts
    {{if is unsafe}}
        "Hazards": {{hazardType}} n/n/
          {{Hazard details}}: noLink
    {{endif}}
    {{if nonCompliant}}
      "Compliance": {{non compliant reason}}: noLink
    {{endif}}
  {{end summaryList}}
}

// Enquiries
// Enquiries and some allegations collect complainants
// Only enquiries collect recieved date or received via
if (investigation.hasComplainant){
  "## {{investigation.type | sentenceCase}}"
  {{ start summaryList}}
      "Received date": enquiry.receivedDate or "Not provided": noLink if exist enquiry.receivedDate
      "Received via": enquiry.reqceivedType or "Not provided": noLink if exist enquiry.reqceivedType
      "Report type": enquiry.type or "Not provided": noLink
      "Contact details": enquiry.sourceContactDetails or "Not provided": noLink
  {{ end summaryList}}
}

// Case general
// All cases have 'about the foo'
"## About the {{investigation.type | sentenceCase}}"
{{ start summaryList }}
  "Status": {{as current}}: linkIfEditRights
  "Assigned to": {{as current}}: linkIfEditRights
  "Created": {{date}}: noLink
  "Created by": {{as current}}: noLink
  "Last updated": {{as current}}: addActivityLink
  {{if tsReference}}
    "Trading Standards reference": {{ts Reference}}
  {{endif}}
{{ end summaryList }}


function getUniqueProductCategories (caseID){
  // Product category may exist on investigation, and/or for each product attached to the case.
  // Return a comma separated list of product categories combining these two sources.
  // eg: "Toy" | "Toy, White goods"
}
