<% page_heading = "Change the notifying country" %>
<% page_title page_heading, errors: @notifying_country_form.errors.any? %>

<% content_for :back_link do %>
  <%= govukBackLink(
    text: "Back to #{@investigation.pretty_description.downcase}",
    href: investigation_path(@investigation)
  ) %>
<% end %>

<%= render "investigations/pages_top", investigation: @investigation %>

<%= form_with scope: :investigation, model: @notifying_country_form, url: investigation_notifying_country_path(@investigation), html: {novalidate: true}, method: :put, local: true do |form| %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
      <%= error_summary @notifying_country_form.errors %>
      <%= render "minimal_investigation_heading", investigation: @investigation, title: "Change the notifying country" %>

      <%= govukRadios(
          idPrefix: "overseas_or_uk",
          name: "investigation[overseas_or_uk]",
          key: :overseas_or_uk,
          items: [
            {
              value: "overseas",
              text: "Overseas countries",
              id: "overseas_or_uk_overseas",
              checked: params.dig(:investigation, :overseas_or_uk) == "overseas" || !@notifying_country_form.country&.match?(/country:GB/),
              conditional: {
                html: govukSelect(
                  form: form,
                  key: :notifying_country_overseas,
                  formGroup: { classes: "app-!-autocomplete--max-width-one-half" },
                  items: options_for_notifying_country(Country.overseas_notifying_countries, @notifying_country_form),
                  include_blank: true,
                  id: "notifying-country-overseas",
                  name: "investigation[notifying_country_overseas]",
                  label: {
                    text: "Select which overseas country",
                    classes: "govuk-label"
                  },
                )
              }
            },
            {
              value: "uk",
              text: "UK nations",
              id: "overseas_or_uk_uk",
              checked: params.dig(:investigation, :overseas_or_uk) == "uk" || @notifying_country_form.country&.match?(/country:GB-/),
              conditional: {
                html: govukSelect(
                  form: form,
                  key: :notifying_country_uk,
                  formGroup: { classes: "app-!-autocomplete--max-width-one-half" },
                  items: options_for_notifying_country(Country.uk_notifying_countries, @notifying_country_form),
                  include_blank: true,
                  id: "notifying-country-uk",
                  name: "investigation[notifying_country_uk]",
                  label: {
                    text: "Select which country or collection of countries",
                    classes: "govuk-label"
                  },
                  hint: {
                    text: "Great Britain (England, Scotland and Wales) does not include Northern Ireland.",
                    classes: "govuk-!-font-size-16"
                  },
                )
              }
            }
          ]
        )
     %>

      <div class="govuk-form-group">
        <%= govukButton(text: t("Save")) %>
        <p><%= link_to "Cancel", investigation_path(@investigation), class: "govuk-link--no-visited-state" %></p>
      </div>
    </div>
  </div>
<% end %>
