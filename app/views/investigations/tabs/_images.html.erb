<%= page_title "Images - #{@investigation.pretty_id}" %>

<% if @investigation.images.none? %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds-from-desktop">
          <p class="govuk-body">No images</p>
        </div>
      </div>
    </div>
  </div>
<% end %>

<%
  @investigation.images.each.with_index(1) do |image, image_number|
    analyzed = image.metadata["analyzed"]
    safe = image.metadata["safe"]
%>
  <section class="govuk-!-margin-bottom-9">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-three-quarters">
        <h3 class="govuk-heading-m">Case image <%= image_number %></h3>
      </div>
      <div class="govuk-grid-column-one-quarter">
        <div class="opss-text-align-right opss-margin-bottom-1-desktop">
          <% if policy(@investigation).update? %>
            <%= link_to(edit_associated_document_path(@investigation, image), class: "govuk-link govuk-link--no-visited-state govuk-!-font-size-19 opss-text-underline-offset") do %>
              Edit this image<span class="govuk-visually-hidden">: <%= image.title %></span>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
    <dl class="govuk-summary-list opss-summary-list-mixed opss-summary-list-mixed--narrow-dt opss-summary-list-mixed--image">
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">Image and title</dt>
        <dd class="govuk-summary-list__value">
          <% if analyzed && safe %>
            <figure>
              <%= link_to image, class: "govuk-link govuk-link--no-visited-state", target: "_blank", title: "Opens in a new tab" do %>
                <%= render("documents/image_tag", image: image, dimensions: "300x200", class_name: nil) %>
              <% end %>
              <figcaption><%= image.title %></figcaption>
            </figure>
          <% else %>
            <div class="app-document-preview ">
               <div class="app-document-preview__image">
                   <a target="_blank" rel="noopener" href="#">
                     <%= image_tag "img-icon.png", alt: "" %>
                     <span class="govuk-visually-hidden">(opens in new tab)</span>
                   </a>
               </div>
             </div>
          <% end %>
        </dd>
      </div>
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">Image description</dt>
        <dd class="govuk-summary-list__value"><%= image.description %></dd>
      </div>
      <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">Updated</dt>
          <dd class="govuk-summary-list__value"><%= file_updated_date_in_govuk_format image %></dd>
      </div>
    </dl>
    <div class="opss-text-align-right opss-margin-bottom-1-desktop">
      <% if policy(@investigation).update? %>
        <%= link_to(remove_associated_document_path(@investigation, image), class: "govuk-link govuk-link--no-visited-state govuk-!-font-size-16 opss-text-underline-offset") do %>
          Remove this image<span class="govuk-visually-hidden">: <%= image.title %></span>
        <% end %>
      <% end %>
    </div>
  </section>
<% end %>
