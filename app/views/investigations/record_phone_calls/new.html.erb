<%= page_title "Record phone call", errors: @correspondence_form.errors.any? %>
<% content_for :back_link do %>
  <%= govukBackLink(
    text: "Back",
    href: new_investigation_correspondence_path(@investigation)
  ) %>
<% end %>

<%= render "investigations/pages_top", investigation: @investigation %>

<%= form_with(model: @correspondence_form, local: true, url: investigation_phone_calls_path(@investigation), builder: ApplicationFormBuilder, html: { novalidate: true }) do |form| %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
      <%= render "form_components/govuk_error_summary", form: form %>

      <span class="govuk-caption-l"><%= @investigation.pretty_description %></span>

      <h1 class="govuk-heading-l">Record phone call</h1>

      <%= render "components/govuk_fieldset",
                 legend: { text: "Who was the call with?", classes: "govuk-fieldset__legend--m" } do %>
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            <%= render "form_components/govuk_input",
                       key: :correspondent_name,
                       form: form,
                       label: { text: "Name" } %>
            <%= render "form_components/govuk_input",
                       key: :phone_number,
                       form: form,
                       label: { text: "Phone number" },
                       hint: { text: "Please include any dialing codes etc" } %>
          </div>
        </div>
      <% end %>

      <%= form.govuk_date_input :correspondence_date, legend: "Date of call" %>
      <%#= render "form_components/govuk_date_input",
      form: form,
      key: :correspondence_date,
      fieldset: { legend: { classes: "govuk-fieldset__legend--m", text: "Date of call" } } %>


      <%= form.govuk_input :overview, classes: "govuk-!-width-two-thirds", label: "Summary", label_classes: "govuk-label--m", hint: "Give an overview of the phone call" %>
      <!--
           <%= render "form_components/govuk_input",
           key: :overview,
           form: form,
           classes: "govuk-!-width-two-thirds",
           label: { text: "Summary", classes: "govuk-label--m" },
           hint: { text: "Give an overview of the phone call" } %>
      -->
      <%= render "components/govuk_fieldset",
                 legend: { text: "Details", classes: "govuk-fieldset__legend--m" },
                 describedBy: "details-hint" do %>
        <span id="details-hint" class="govuk-hint govuk-!-width-full">Upload the transcript if you have one, or enter notes below</span>

        <div class="govuk-form-group">
          <% if @transcript_blob %>
            <p>
              Currently selected file: <%= link_to @transcript_blob.filename, @transcript_blob, target: "_blank", rel: 'noopener' %><br>]
              Selecting a different one will replace it.
            </p>
          <% end %>

          <%= form.govuk_file_upload :transcript, label: "Upload a file", label_classes: "govuk-label", classes: "govuk-file-upload" %>
        </div>

        <%= form.govuk_text_area :details, label: "Notes", label_classes: "govuk-!-width-two-thirds", attributes: { maxlength: 50_000 } %>

      <% end %>

      <%= form.submit "Continue", class: "govuk-button" %>

      <%= permission_notice(text: t("case.protected_details", data_type: "phone call correspondence")) %>
    </div>
  </div>
<% end %>
