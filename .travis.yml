sudo: required

language: generic

services:
  - docker

branches:
  only:
    - master

cache:
  directories:
    - ~/bundle-cache
    - ~/node-cache
    - ~/coverage-cache

stages:
  - name: Remove review app
    if: branch = master AND type = push

jobs:
  include:
    - stage: Deploy review app # not used anymore, but removing this will cause travis to hung forever
      script: pwd
      env: &deploy_int_env
        - SPACE=int
        - BRANCH=${TRAVIS_BRANCH}
        - BUILD_ID=${TRAVIS_BUILD_NUMBER}
        - CF_STAGING_TIMEOUT=30 # Extend CF staging timeout to 30 minutes
        - secure: "L3YrItbq7NMkzOQUq1wYDskdBnV5R2zjGQ0whwe+3g+a/eUlZX1COZ6fxZkabkPqtbqpPlPhfkbhRKQzWKGrXYmMhk9UDXo1kNrCN1QJWVMfy4WkfC5M9L876oYMweK85i0cCaQHvPhnDVF4uLdSq3Y4nsIjo/0I6iC5h0OmCdT9pOLBJItsLAnlmAM7KcumRYVFdwLHsmnxUg/f6SsEbuA7TrEK21EGQnOyTSys0GongkHSu9j/Xa6MqXuZ3HRHOnLRdfEgfAobRHm5VQqfsyy+sbQCE5yqt8+n6UYIFSnmUja6Dys5jhJK1Mf742gUUhJlXwz+nX0jFoVwN7D9V1To3VV1zaTSzPnD1eh7wOyo39Mu6E1D3SrHE1YL1l4urIixt0FsKEbuue6qAnejtauLH6RKVPJkiU6ZT5o1lj1nkwueghLfQ4ol0XIHOYtSAdhFPHEk1y6ZgmHcLUcioY/raW4Ht0VWI96Yn6RTPPMch4jZYJBvgdgfWHv040N4KmdUVqSfT4MZGKc9iH1dxXM5v9QiKJXtr7Sy6ULAYUttYpWqiedq63JmXZECShD7ptzrec2TejdR1M/yp/G03b7evqo749+23mr8mQ4c7DNeFo4QFNmbrjmMbNGV1nMcX1LqXVZkqunPyiG3oUmqBq2TchhAElBcxsVqoZG6Boo=" # CF_USERNAME
        - secure: "nA9iN+1zxXm1PpcxEBumfgDCJgg9Mrpa0d4kK0a9BxLDrucG0pakPoM7EOP8xzBULdxSfdU8fF1CoSaODqQLl8eB60VW0A+S6S8fk5/cAKszXQuv3yud8n5EL2+QqCexDLuDxDumNWPNpS0mFexSRMpFS90Qx3XXUBHuOFQ2V3AXZaXBJnhCrJqvP7/2Qd9yVHhKA5DBirzDa7LZYHYrWuTxHuqYLdi3f9r4ExpVLeSk3V5UYB73xntEi6p556bb8H6qpgs5P+JX3UntyPCUWVZrIDOjTA3t5AdhPDoQunrHh8ophHjzyiSeoQOxd8MIV1SnX1Gk6hEQrlSuHW+4AzG4xrk8H42Vz7WnpGUEuUc28AZpGZHkQnsAqv07hinGz9nmZPcSWXP6FdLJNKQhBAuo1da6O8+cTv/Hh+a7YCO9q9EhAQi6TIFgqbz8Z3QoWgwIfqlJOHdPcvePV1a8mQ1tYNDQ/V+72iHglNMtsAhG7DsTz2ueTnwvwG+H9bRK2rSNfzSS/2uV/AQLKnM9H3DQaymDFFuxhkitZiI9c7g9nC/8ZOWsK5zaMNODS9CtcRQOw3sWCOre5Id2gy7XWtQcVTVrkw0PeLCtJNBExPSCGD2pd8NCuKxErtjZUhiOpb9hMWyix8IFxpbYRfLWCfz0aeMpWl7lfe4eXuSXCwU=" # CF_PASSWORD

    - stage: Remove review app
      name: Remove review app
      script: ./infrastructure/ci/cleanup-review-app.sh
      env:
        - SPACE=int
        - CF_STAGING_TIMEOUT=30 # Extend CF staging timeout to 30 minutes
        - secure: "L3YrItbq7NMkzOQUq1wYDskdBnV5R2zjGQ0whwe+3g+a/eUlZX1COZ6fxZkabkPqtbqpPlPhfkbhRKQzWKGrXYmMhk9UDXo1kNrCN1QJWVMfy4WkfC5M9L876oYMweK85i0cCaQHvPhnDVF4uLdSq3Y4nsIjo/0I6iC5h0OmCdT9pOLBJItsLAnlmAM7KcumRYVFdwLHsmnxUg/f6SsEbuA7TrEK21EGQnOyTSys0GongkHSu9j/Xa6MqXuZ3HRHOnLRdfEgfAobRHm5VQqfsyy+sbQCE5yqt8+n6UYIFSnmUja6Dys5jhJK1Mf742gUUhJlXwz+nX0jFoVwN7D9V1To3VV1zaTSzPnD1eh7wOyo39Mu6E1D3SrHE1YL1l4urIixt0FsKEbuue6qAnejtauLH6RKVPJkiU6ZT5o1lj1nkwueghLfQ4ol0XIHOYtSAdhFPHEk1y6ZgmHcLUcioY/raW4Ht0VWI96Yn6RTPPMch4jZYJBvgdgfWHv040N4KmdUVqSfT4MZGKc9iH1dxXM5v9QiKJXtr7Sy6ULAYUttYpWqiedq63JmXZECShD7ptzrec2TejdR1M/yp/G03b7evqo749+23mr8mQ4c7DNeFo4QFNmbrjmMbNGV1nMcX1LqXVZkqunPyiG3oUmqBq2TchhAElBcxsVqoZG6Boo=" # CF_USERNAME
        - secure: "nA9iN+1zxXm1PpcxEBumfgDCJgg9Mrpa0d4kK0a9BxLDrucG0pakPoM7EOP8xzBULdxSfdU8fF1CoSaODqQLl8eB60VW0A+S6S8fk5/cAKszXQuv3yud8n5EL2+QqCexDLuDxDumNWPNpS0mFexSRMpFS90Qx3XXUBHuOFQ2V3AXZaXBJnhCrJqvP7/2Qd9yVHhKA5DBirzDa7LZYHYrWuTxHuqYLdi3f9r4ExpVLeSk3V5UYB73xntEi6p556bb8H6qpgs5P+JX3UntyPCUWVZrIDOjTA3t5AdhPDoQunrHh8ophHjzyiSeoQOxd8MIV1SnX1Gk6hEQrlSuHW+4AzG4xrk8H42Vz7WnpGUEuUc28AZpGZHkQnsAqv07hinGz9nmZPcSWXP6FdLJNKQhBAuo1da6O8+cTv/Hh+a7YCO9q9EhAQi6TIFgqbz8Z3QoWgwIfqlJOHdPcvePV1a8mQ1tYNDQ/V+72iHglNMtsAhG7DsTz2ueTnwvwG+H9bRK2rSNfzSS/2uV/AQLKnM9H3DQaymDFFuxhkitZiI9c7g9nC/8ZOWsK5zaMNODS9CtcRQOw3sWCOre5Id2gy7XWtQcVTVrkw0PeLCtJNBExPSCGD2pd8NCuKxErtjZUhiOpb9hMWyix8IFxpbYRfLWCfz0aeMpWl7lfe4eXuSXCwU=" # CF_PASSWORD

notifications:
  webhooks: https://coveralls.io/webhook

env:
  global:
    - secure: "mpUgdDSPTRtgppkrYbcYYuDwRM1eAs1pBtL4PWI3ss3swA4uIGwALUOC+PB2HKqJ28SStTePgSYMpCiZNrV7yLdlPmM2VbTdyD9Fa0lInPeiCjAkvwduVmCft/n6OQKEZKAuCukajVsdVz/7pCwMj/AIJYYd7sYSLcNYrEEVzzgwTe2AfLM28098s5Tczz3Yqbm7WRcDPTJLXh9k0Htj41AzkXNZHGR1yCT8jkVHpbyPM+KXy0Ci71ImcqJ4ksBVy9Lh0HkUYFyaKlUcVh+iLzD8DDkBNuL9E/PMvp1hpl+31ClDgIXNxr17nUf8oO0DNKvX6gMs5KNVCdXtpEkhQoVDpUcBAr9nNHUf+X4vejgHfMcn+0ptdfRDrCsfHe6b1hThdWTZ0SKcX8i2e5RHDlJPYT5JwqPbb1C6v0mWsaQiyLz+rvLz8bH9Cj9Jk/tG/6HyHsVX9MfStpsYQnL6bckY7+GUd786XS1KCOpuXHwMouunJiEhTTHVEQtqEDLSSJgE9iZ+7VcJlVXx9BdCIBawKsT/qqvuSEVOx3CunKCiBsr+M4HMDw3LqDQgdT1pB6QKFtGsZqaIPuE4+tA7GOeJb4SM35UhXOMR9K4GOJAHRmTBahn1+2UPl1hrCoK4JMdHs2Zm84NkE4LRcFTy2crfmLMsa5wMVz1MTdFw6fI=" # NOTIFY_API_KEY
